
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../commands/">
      
      
        <link rel="next" href="../material/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Getting Started - Lazurite</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Lazurite" class="md-header__button md-logo" aria-label="Lazurite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23.964 15.266-8.687 8.669c-.034.035-.086.052-.121.035L3.29 20.79c-.052-.017-.087-.052-.087-.086L.007 8.856c-.018-.053 0-.087.035-.122L8.728.065c.035-.035.087-.052.121-.035l11.866 3.18c.052.017.087.052.087.086l3.18 11.848c.034.053.016.087-.018.122m-11.64-9.433L.667 8.943c-.017 0-.035.034-.017.052l8.53 8.512c.017.017.052.017.052-.017l3.127-11.64c.017 0-.018-.035-.035-.017"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lazurite
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Getting Started
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue-grey" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Lazurite" class="md-nav__button md-logo" aria-label="Lazurite" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23.964 15.266-8.687 8.669c-.034.035-.086.052-.121.035L3.29 20.79c-.052-.017-.087-.052-.087-.086L.007 8.856c-.018-.053 0-.087.035-.122L8.728.065c.035-.035.087-.052.121-.035l11.866 3.18c.052.017.087.052.087.086l3.18 11.848c.034.053.016.087-.018.122m-11.64-9.433L.667 8.943c-.017 0-.035.034-.017.052l8.53 8.512c.017.017.052.017.052-.017l3.127-11.64c.017 0-.018-.035-.035-.017"/></svg>

    </a>
    Lazurite
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-project" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a new project
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obtaining-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Obtaining source code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Obtaining source code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formatting" class="md-nav__link">
    <span class="md-ellipsis">
      Formatting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Formatting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertexsc" class="md-nav__link">
    <span class="md-ellipsis">
      vertex.sc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fragmentsc" class="md-nav__link">
    <span class="md-ellipsis">
      fragment.sc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projectjson" class="md-nav__link">
    <span class="md-ellipsis">
      project.json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-shader-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Adding shader effects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../material/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Material Format
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../platforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Platforms
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-new-project" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a new project
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#obtaining-source-code" class="md-nav__link">
    <span class="md-ellipsis">
      Obtaining source code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Obtaining source code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formatting" class="md-nav__link">
    <span class="md-ellipsis">
      Formatting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Formatting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertexsc" class="md-nav__link">
    <span class="md-ellipsis">
      vertex.sc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fragmentsc" class="md-nav__link">
    <span class="md-ellipsis">
      fragment.sc
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projectjson" class="md-nav__link">
    <span class="md-ellipsis">
      project.json
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-shader-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Adding shader effects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<p>This guide will walk you through the process of creating your first shader with lazurite, step by step.
We will be creating a simple terrain shader, that modifies RenderChunk material.</p>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<p>First, you need to install lazurite (see <a href="../#installation">installation instructions</a>). We will also need shaderc
compiler executable, in order to compile shaders from source code. See <a href="../commands/#build">build command</a> for download links.</p>
<p>Some general <a href="https://thebookofshaders.com">shader theory</a> and BGFX <a href="https://bkaradzic.github.io/bgfx/tools.html#shader-compiler-shaderc">shader compiler</a>
knowledge would also help.</p>
<div class="admonition tip">
<p class="admonition-title">BGFX</p>
<p>BGFX is the cross platform graphics library that RenderDragon is built on top of.</p>
</div>
<h2 id="creating-a-new-project">Creating a new project<a class="headerlink" href="#creating-a-new-project" title="Permanent link">&para;</a></h2>
<p>First, let's create a new project. Make a new folder. In this guide we will call it <code>helloWorld</code>.
Add <code>project.json</code> file into it (leave it empty for now), and make a new <code>RenderChunk</code> folder inside of <code>helloWorld</code>.
This folder represents a RenderChunk material (RenderChunk.material.bin)
that we will be modifying. Then add <code>shaders</code> folder inside of <code>RenderChunk</code>, this is where shader source code will go.
Also add a <code>vanilla</code> folder, next to your project folder and copy your vanilla <code>RenderChunk.material.bin</code> file into it.</p>
<p>Resulting directory tree should look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>helloWorld/
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>├── RenderChunk/
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>│   └── shaders/
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>└── project.json
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>vanilla/
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>└── RenderChunk.material.bin
</code></pre></div>
<h2 id="obtaining-source-code">Obtaining source code<a class="headerlink" href="#obtaining-source-code" title="Permanent link">&para;</a></h2>
<p>Next step would be to get the source code. This guide will show you how to obtain it by yourself.</p>
<div class="admonition warning">
<p class="admonition-title">Restoring latest Android materials</p>
<p>Starting from 1.21.31.05 release and 1.21.20.24 preview, restore command can no longer restore source code from Android materials since it's no longer shipped in material.bin files in a readable form. Instead, you can get it from older game versions by restoring their respective material.bin files or by downloading already restored code from <a href="https://github.com/veka0/mcbe-shader-codebase">mcbe codebase repository</a></p>
</div>
<p>Lazurite has a <a href="../commands/#restore">restore</a> command that can partially recover source code from <strong><em>Android</em></strong> materials* (only for older versions; see above warning).
You can use it on RenderChunk.material.bin file that you copied from your Android game installation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>lazurite<span class="w"> </span>restore<span class="w"> </span>RenderChunk.material.bin
</code></pre></div>
<p>Which should generate 3 files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>RenderChunk.ESSL_310.Fragment.sc
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>RenderChunk.ESSL_310.Vertex.sc
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>RenderChunk.varying.def.sc
</code></pre></div>
<p>Or you can also get the results of a <code>restore</code> command from this repository: <a href="https://github.com/veka0/mcbe-shader-codebase/tree/main/materials/RenderChunk">https://github.com/veka0/mcbe-shader-codebase/tree/main/materials/RenderChunk</a></p>
<p>You also need a <a href="https://github.com/SurvivalApparatusCommunication/RenderDragonSourceCodeInv/blob/1.20.60/include/bgfx_shader.sh">bgfx_shader.sh</a> file</p>
<p>Copy those files into <code>shaders/</code> directory in RenderChunk and rename them, to get the following directory tree:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>helloWorld/
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>├── RenderChunk/
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>│   └── shaders/
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>│       ├── bgfx_shader.sh
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>│       ├── fragment.sc
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>│       ├── vertex.sc
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>│       └── varying.def.sc
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>└── project.json
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>vanilla/
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>└── RenderChunk.material.bin
</code></pre></div>
<h3 id="formatting">Formatting<a class="headerlink" href="#formatting" title="Permanent link">&para;</a></h3>
<p>Source code, generated with restore command is not immediately compilable and requires manual editing to make it work.
We will be doing the bare minimum editing that's required to compile RenderChunk shaders.</p>
<h4 id="vertexsc">vertex.sc<a class="headerlink" href="#vertexsc" title="Permanent link">&para;</a></h4>
<p>Let's start by editing vertex.sc.</p>
<p>First, add the <code>#include "bgfx_shader.sh"</code> line at the beginning of the file, but after <code>$input</code> and <code>$output</code> directives. This is a necessary step for all BGFX shaders and it should look something like this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="err">$</span><span class="kr">input</span><span class="w"> </span><span class="n">a_color0</span><span class="p">,</span><span class="w"> </span><span class="n">a_position</span><span class="p">,</span><span class="w"> </span><span class="n">a_texcoord0</span><span class="p">,</span><span class="w"> </span><span class="n">a_texcoord1</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="cp">#ifdef INSTANCING__ON</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="err">$</span><span class="kr">input</span><span class="w"> </span><span class="n">i_data1</span><span class="p">,</span><span class="w"> </span><span class="n">i_data2</span><span class="p">,</span><span class="w"> </span><span class="n">i_data3</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="cp">#endif</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="err">$</span><span class="kr">output</span><span class="w"> </span><span class="n">v_color0</span><span class="p">,</span><span class="w"> </span><span class="n">v_fog</span><span class="p">,</span><span class="w"> </span><span class="n">v_lightmapUV</span><span class="p">,</span><span class="w"> </span><span class="n">v_texcoord0</span><span class="p">,</span><span class="w"> </span><span class="n">v_worldPos</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="hll"><span class="cp">#include &quot;bgfx_shader.sh&quot;</span>
</span></code></pre></div></td></tr></table></div>
<hr />
<p>Then remove the following code at the start of the file. It's not needed since <code>instMul</code> functions are added from <code>bgfx_shader.sh</code></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="cp">#ifdef INSTANCING__ON</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">instMul</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">_vec</span><span class="p">,</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">_mtx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">_vec</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_mtx</span><span class="p">));</span><span class="w"> </span><span class="c1">// Attention!</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="p">}</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">instMul</span><span class="p">(</span><span class="kt">mat3</span><span class="w"> </span><span class="n">_mtx</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_vec</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">_mtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_vec</span><span class="p">));</span><span class="w"> </span><span class="c1">// Attention!</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="p">}</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">instMul</span><span class="p">(</span><span class="kt">vec4</span><span class="w"> </span><span class="n">_vec</span><span class="p">,</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">_mtx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">_vec</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_mtx</span><span class="p">));</span><span class="w"> </span><span class="c1">// Attention!</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="p">}</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">instMul</span><span class="p">(</span><span class="kt">mat4</span><span class="w"> </span><span class="n">_mtx</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">_vec</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">_mtx</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">_vec</span><span class="p">));</span><span class="w"> </span><span class="c1">// Attention!</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="p">}</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="cp">#endif</span>
</code></pre></div></td></tr></table></div>
<p>Next, we need to go through the code marked with <code>// Attention!</code> comment.
Lazurite marks lines of code in this way, if they may contain matrix multiplication or matrix element access.</p>
<p>By convention, multiplying matrices by other matrices or vectors in BGFX shaders has to be done with a <code>mul()</code> function.
In addition, GLSL uses a different matrix row-column order in comparison to other APIs, so we need to switch row and column indices
when shader is compiled for APIs other than GLSL.</p>
<p>Edit the following function:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">jitterVertexPosition</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">offsetProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Proj</span><span class="p">;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Attention!</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="c1">// Attention!</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">offsetProj</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(((</span><span class="n">View</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">vec4</span><span class="p">(</span><span class="n">worldPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="n">f</span><span class="p">)))));</span><span class="w"> </span><span class="c1">// Attention!</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Into this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">jitterVertexPosition</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">offsetProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Proj</span><span class="p">;</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="cp">#if BGFX_SHADER_LANGUAGE_GLSL</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="cp">#else</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mo">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">offsetProj</span><span class="p">,</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">View</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">worldPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="n">f</span><span class="p">)));</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>In this function:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">transformAsBillboardVertex</span><span class="p">(</span><span class="k">inout</span><span class="w"> </span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ViewPositionAndTime</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">forward</span><span class="p">));</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">vertInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">offsets</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">offsets</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="hll"><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ViewProj</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">vec4</span><span class="p">(</span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)));</span><span class="w"> </span><span class="c1">// Attention!</span>
</span><a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>edit the highlighted line into this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="n">vertOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">ViewProj</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>In this function:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_VertSharedTransform</span><span class="p">(</span><span class="k">inout</span><span class="w"> </span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">vertInput</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="cp">#ifdef INSTANCING__OFF</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="hll"><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">wpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">World</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">))).</span><span class="n">xyz</span><span class="p">;</span><span class="w"> </span><span class="c1">// Attention!</span>
</span><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="cp">#ifdef INSTANCING__ON</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">wpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instMul</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="hll"><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">ViewProj</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">vec4</span><span class="p">(</span><span class="n">wpos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)));</span><span class="w"> </span><span class="c1">// Attention!</span>
</span><a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">    </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wpos</span><span class="p">;</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wpos</span><span class="p">;</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>edit the 2 highlighted lines into this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">wpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">World</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="n">vertOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">ViewProj</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">wpos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
</code></pre></div></td></tr></table></div>
<p>And this is it! <code>vertex.sc</code> can now be compiled correctly.</p>
<h4 id="fragmentsc">fragment.sc<a class="headerlink" href="#fragmentsc" title="Permanent link">&para;</a></h4>
<p>Next, let's edit fragment shader code. Similar to vertex shader, start by adding <code>#include "bgfx_shader.sh"</code> line at the beginning after <code>$input</code> directives, which should look like this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="err">$</span><span class="kr">input</span><span class="w"> </span><span class="n">v_color0</span><span class="p">,</span><span class="w"> </span><span class="n">v_fog</span><span class="p">,</span><span class="w"> </span><span class="n">v_lightmapUV</span><span class="p">,</span><span class="w"> </span><span class="n">v_texcoord0</span><span class="p">,</span><span class="w"> </span><span class="n">v_worldPos</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="hll"><span class="cp">#include &quot;bgfx_shader.sh&quot;</span>
</span></code></pre></div></td></tr></table></div>
<p>Now we need to modify texture sampling methods to use the correct cross-platform BGFX functions, which requires changing the following code:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="p">}</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler3D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="p">}</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">samplerCube</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="p">}</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">textureLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="p">}</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler3D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">textureLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="p">}</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2DArray</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="p">}</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2DArray</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">textureLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Into this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2D</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="p">}</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler3D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture3D</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="p">}</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">samplerCube</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">textureCube</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="p">}</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2DLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="p">}</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler3D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture3DLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="p">}</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2DArray</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2DArray</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="p">}</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2DArray</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2DArrayLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Then remove the following code, since it's already included in <code>bgfx_shader.sh</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="cp">#if defined(SEASONS__ON)&amp;&amp;(defined(ALPHA_TEST_PASS)|| defined(OPAQUE_PASS))</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">vec3_splat</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">_x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span><span class="w"> </span><span class="n">_x</span><span class="p">,</span><span class="w"> </span><span class="n">_x</span><span class="p">);</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="p">}</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="cp">#endif</span>
</code></pre></div></td></tr></table></div>
<p>Finally, we need to edit the following function:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_Opaque_Frag</span><span class="p">(</span><span class="n">FragmentInput</span><span class="w"> </span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">FragmentOutput</span><span class="w"> </span><span class="n">fragOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">surfaceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StandardTemplate_DefaultInput</span><span class="p">(</span><span class="n">fragInput</span><span class="p">);</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StandardTemplate_DefaultOutput</span><span class="p">();</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">UV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">    </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">    </span><span class="cp">#if defined(ALPHA_TEST_PASS)|| defined(DEPTH_ONLY_PASS)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">    </span><span class="n">RenderChunkSurfAlpha</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">    </span><span class="cp">#if defined(DEPTH_ONLY_OPAQUE_PASS)|| defined(OPAQUE_PASS)</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">    </span><span class="n">RenderChunkSurfOpaque</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">    </span><span class="cp">#ifdef TRANSPARENT_PASS</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">    </span><span class="n">RenderChunkSurfTransparent</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">    </span><span class="n">StandardTemplate_CustomSurfaceShaderEntryIdentity</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">UV</span><span class="p">,</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">    </span><span class="n">DirectionalLight</span><span class="w"> </span><span class="n">primaryLight</span><span class="p">;</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldLightDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LightWorldSpaceDirection</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="hll"><span class="w">    </span><span class="n">primaryLight</span><span class="p">.</span><span class="n">ViewSpaceDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">View</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="kt">vec4</span><span class="p">(</span><span class="n">worldLightDirection</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">))).</span><span class="n">xyz</span><span class="p">;</span><span class="w"> </span><span class="c1">// Attention!</span>
</span><a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="w">    </span><span class="n">primaryLight</span><span class="p">.</span><span class="n">Intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LightDiffuseColorAndIlluminance</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">LightDiffuseColorAndIlluminance</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="w">    </span><span class="n">CompositingOutput</span><span class="w"> </span><span class="n">compositingOutput</span><span class="p">;</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="w">    </span><span class="n">compositingOutput</span><span class="p">.</span><span class="n">mLitColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">computeLighting_RenderChunk</span><span class="p">(</span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">,</span><span class="w"> </span><span class="n">primaryLight</span><span class="p">);</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="w">    </span><span class="n">fragOutput</span><span class="p">.</span><span class="n">Color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">standardComposite</span><span class="p">(</span><span class="n">surfaceOutput</span><span class="p">,</span><span class="w"> </span><span class="n">compositingOutput</span><span class="p">);</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="w">    </span><span class="n">RenderChunkApplyFog</span><span class="p">(</span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">,</span><span class="w"> </span><span class="n">fragOutput</span><span class="p">);</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>by changing highlighted line into this:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="n">primaryLight</span><span class="p">.</span><span class="n">ViewSpaceDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">View</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">worldLightDirection</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>And we're done! Both fragment and vertex shaders are now compilable. <code>varying.def.sc</code> doesn't require any editing in this guide.</p>
<p>Below you can find the edited files (which were also additionally cleaned up, for better code readability):</p>
<details class="info">
<summary>fragment.sc</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">fragment.sc</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">  1</a></span>
<span class="normal"><a href="#__codelineno-19-2">  2</a></span>
<span class="normal"><a href="#__codelineno-19-3">  3</a></span>
<span class="normal"><a href="#__codelineno-19-4">  4</a></span>
<span class="normal"><a href="#__codelineno-19-5">  5</a></span>
<span class="normal"><a href="#__codelineno-19-6">  6</a></span>
<span class="normal"><a href="#__codelineno-19-7">  7</a></span>
<span class="normal"><a href="#__codelineno-19-8">  8</a></span>
<span class="normal"><a href="#__codelineno-19-9">  9</a></span>
<span class="normal"><a href="#__codelineno-19-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-19-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-19-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-19-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-19-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-19-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-19-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-19-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-19-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-19-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-19-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-19-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-19-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-19-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-19-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-19-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-19-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-19-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-19-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-19-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-19-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-19-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-19-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-19-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-19-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-19-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-19-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-19-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-19-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-19-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-19-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-19-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-19-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-19-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-19-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-19-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-19-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-19-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-19-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-19-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-19-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-19-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-19-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-19-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-19-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-19-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-19-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-19-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-19-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-19-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-19-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-19-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-19-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-19-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-19-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-19-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-19-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-19-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-19-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-19-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-19-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-19-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-19-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-19-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-19-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-19-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-19-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-19-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-19-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-19-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-19-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-19-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-19-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-19-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-19-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-19-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-19-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-19-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-19-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-19-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-19-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-19-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-19-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-19-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-19-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-19-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-19-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-19-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-19-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-19-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-19-100">100</a></span>
<span class="normal"><a href="#__codelineno-19-101">101</a></span>
<span class="normal"><a href="#__codelineno-19-102">102</a></span>
<span class="normal"><a href="#__codelineno-19-103">103</a></span>
<span class="normal"><a href="#__codelineno-19-104">104</a></span>
<span class="normal"><a href="#__codelineno-19-105">105</a></span>
<span class="normal"><a href="#__codelineno-19-106">106</a></span>
<span class="normal"><a href="#__codelineno-19-107">107</a></span>
<span class="normal"><a href="#__codelineno-19-108">108</a></span>
<span class="normal"><a href="#__codelineno-19-109">109</a></span>
<span class="normal"><a href="#__codelineno-19-110">110</a></span>
<span class="normal"><a href="#__codelineno-19-111">111</a></span>
<span class="normal"><a href="#__codelineno-19-112">112</a></span>
<span class="normal"><a href="#__codelineno-19-113">113</a></span>
<span class="normal"><a href="#__codelineno-19-114">114</a></span>
<span class="normal"><a href="#__codelineno-19-115">115</a></span>
<span class="normal"><a href="#__codelineno-19-116">116</a></span>
<span class="normal"><a href="#__codelineno-19-117">117</a></span>
<span class="normal"><a href="#__codelineno-19-118">118</a></span>
<span class="normal"><a href="#__codelineno-19-119">119</a></span>
<span class="normal"><a href="#__codelineno-19-120">120</a></span>
<span class="normal"><a href="#__codelineno-19-121">121</a></span>
<span class="normal"><a href="#__codelineno-19-122">122</a></span>
<span class="normal"><a href="#__codelineno-19-123">123</a></span>
<span class="normal"><a href="#__codelineno-19-124">124</a></span>
<span class="normal"><a href="#__codelineno-19-125">125</a></span>
<span class="normal"><a href="#__codelineno-19-126">126</a></span>
<span class="normal"><a href="#__codelineno-19-127">127</a></span>
<span class="normal"><a href="#__codelineno-19-128">128</a></span>
<span class="normal"><a href="#__codelineno-19-129">129</a></span>
<span class="normal"><a href="#__codelineno-19-130">130</a></span>
<span class="normal"><a href="#__codelineno-19-131">131</a></span>
<span class="normal"><a href="#__codelineno-19-132">132</a></span>
<span class="normal"><a href="#__codelineno-19-133">133</a></span>
<span class="normal"><a href="#__codelineno-19-134">134</a></span>
<span class="normal"><a href="#__codelineno-19-135">135</a></span>
<span class="normal"><a href="#__codelineno-19-136">136</a></span>
<span class="normal"><a href="#__codelineno-19-137">137</a></span>
<span class="normal"><a href="#__codelineno-19-138">138</a></span>
<span class="normal"><a href="#__codelineno-19-139">139</a></span>
<span class="normal"><a href="#__codelineno-19-140">140</a></span>
<span class="normal"><a href="#__codelineno-19-141">141</a></span>
<span class="normal"><a href="#__codelineno-19-142">142</a></span>
<span class="normal"><a href="#__codelineno-19-143">143</a></span>
<span class="normal"><a href="#__codelineno-19-144">144</a></span>
<span class="normal"><a href="#__codelineno-19-145">145</a></span>
<span class="normal"><a href="#__codelineno-19-146">146</a></span>
<span class="normal"><a href="#__codelineno-19-147">147</a></span>
<span class="normal"><a href="#__codelineno-19-148">148</a></span>
<span class="normal"><a href="#__codelineno-19-149">149</a></span>
<span class="normal"><a href="#__codelineno-19-150">150</a></span>
<span class="normal"><a href="#__codelineno-19-151">151</a></span>
<span class="normal"><a href="#__codelineno-19-152">152</a></span>
<span class="normal"><a href="#__codelineno-19-153">153</a></span>
<span class="normal"><a href="#__codelineno-19-154">154</a></span>
<span class="normal"><a href="#__codelineno-19-155">155</a></span>
<span class="normal"><a href="#__codelineno-19-156">156</a></span>
<span class="normal"><a href="#__codelineno-19-157">157</a></span>
<span class="normal"><a href="#__codelineno-19-158">158</a></span>
<span class="normal"><a href="#__codelineno-19-159">159</a></span>
<span class="normal"><a href="#__codelineno-19-160">160</a></span>
<span class="normal"><a href="#__codelineno-19-161">161</a></span>
<span class="normal"><a href="#__codelineno-19-162">162</a></span>
<span class="normal"><a href="#__codelineno-19-163">163</a></span>
<span class="normal"><a href="#__codelineno-19-164">164</a></span>
<span class="normal"><a href="#__codelineno-19-165">165</a></span>
<span class="normal"><a href="#__codelineno-19-166">166</a></span>
<span class="normal"><a href="#__codelineno-19-167">167</a></span>
<span class="normal"><a href="#__codelineno-19-168">168</a></span>
<span class="normal"><a href="#__codelineno-19-169">169</a></span>
<span class="normal"><a href="#__codelineno-19-170">170</a></span>
<span class="normal"><a href="#__codelineno-19-171">171</a></span>
<span class="normal"><a href="#__codelineno-19-172">172</a></span>
<span class="normal"><a href="#__codelineno-19-173">173</a></span>
<span class="normal"><a href="#__codelineno-19-174">174</a></span>
<span class="normal"><a href="#__codelineno-19-175">175</a></span>
<span class="normal"><a href="#__codelineno-19-176">176</a></span>
<span class="normal"><a href="#__codelineno-19-177">177</a></span>
<span class="normal"><a href="#__codelineno-19-178">178</a></span>
<span class="normal"><a href="#__codelineno-19-179">179</a></span>
<span class="normal"><a href="#__codelineno-19-180">180</a></span>
<span class="normal"><a href="#__codelineno-19-181">181</a></span>
<span class="normal"><a href="#__codelineno-19-182">182</a></span>
<span class="normal"><a href="#__codelineno-19-183">183</a></span>
<span class="normal"><a href="#__codelineno-19-184">184</a></span>
<span class="normal"><a href="#__codelineno-19-185">185</a></span>
<span class="normal"><a href="#__codelineno-19-186">186</a></span>
<span class="normal"><a href="#__codelineno-19-187">187</a></span>
<span class="normal"><a href="#__codelineno-19-188">188</a></span>
<span class="normal"><a href="#__codelineno-19-189">189</a></span>
<span class="normal"><a href="#__codelineno-19-190">190</a></span>
<span class="normal"><a href="#__codelineno-19-191">191</a></span>
<span class="normal"><a href="#__codelineno-19-192">192</a></span>
<span class="normal"><a href="#__codelineno-19-193">193</a></span>
<span class="normal"><a href="#__codelineno-19-194">194</a></span>
<span class="normal"><a href="#__codelineno-19-195">195</a></span>
<span class="normal"><a href="#__codelineno-19-196">196</a></span>
<span class="normal"><a href="#__codelineno-19-197">197</a></span>
<span class="normal"><a href="#__codelineno-19-198">198</a></span>
<span class="normal"><a href="#__codelineno-19-199">199</a></span>
<span class="normal"><a href="#__codelineno-19-200">200</a></span>
<span class="normal"><a href="#__codelineno-19-201">201</a></span>
<span class="normal"><a href="#__codelineno-19-202">202</a></span>
<span class="normal"><a href="#__codelineno-19-203">203</a></span>
<span class="normal"><a href="#__codelineno-19-204">204</a></span>
<span class="normal"><a href="#__codelineno-19-205">205</a></span>
<span class="normal"><a href="#__codelineno-19-206">206</a></span>
<span class="normal"><a href="#__codelineno-19-207">207</a></span>
<span class="normal"><a href="#__codelineno-19-208">208</a></span>
<span class="normal"><a href="#__codelineno-19-209">209</a></span>
<span class="normal"><a href="#__codelineno-19-210">210</a></span>
<span class="normal"><a href="#__codelineno-19-211">211</a></span>
<span class="normal"><a href="#__codelineno-19-212">212</a></span>
<span class="normal"><a href="#__codelineno-19-213">213</a></span>
<span class="normal"><a href="#__codelineno-19-214">214</a></span>
<span class="normal"><a href="#__codelineno-19-215">215</a></span>
<span class="normal"><a href="#__codelineno-19-216">216</a></span>
<span class="normal"><a href="#__codelineno-19-217">217</a></span>
<span class="normal"><a href="#__codelineno-19-218">218</a></span>
<span class="normal"><a href="#__codelineno-19-219">219</a></span>
<span class="normal"><a href="#__codelineno-19-220">220</a></span>
<span class="normal"><a href="#__codelineno-19-221">221</a></span>
<span class="normal"><a href="#__codelineno-19-222">222</a></span>
<span class="normal"><a href="#__codelineno-19-223">223</a></span>
<span class="normal"><a href="#__codelineno-19-224">224</a></span>
<span class="normal"><a href="#__codelineno-19-225">225</a></span>
<span class="normal"><a href="#__codelineno-19-226">226</a></span>
<span class="normal"><a href="#__codelineno-19-227">227</a></span>
<span class="normal"><a href="#__codelineno-19-228">228</a></span>
<span class="normal"><a href="#__codelineno-19-229">229</a></span>
<span class="normal"><a href="#__codelineno-19-230">230</a></span>
<span class="normal"><a href="#__codelineno-19-231">231</a></span>
<span class="normal"><a href="#__codelineno-19-232">232</a></span>
<span class="normal"><a href="#__codelineno-19-233">233</a></span>
<span class="normal"><a href="#__codelineno-19-234">234</a></span>
<span class="normal"><a href="#__codelineno-19-235">235</a></span>
<span class="normal"><a href="#__codelineno-19-236">236</a></span>
<span class="normal"><a href="#__codelineno-19-237">237</a></span>
<span class="normal"><a href="#__codelineno-19-238">238</a></span>
<span class="normal"><a href="#__codelineno-19-239">239</a></span>
<span class="normal"><a href="#__codelineno-19-240">240</a></span>
<span class="normal"><a href="#__codelineno-19-241">241</a></span>
<span class="normal"><a href="#__codelineno-19-242">242</a></span>
<span class="normal"><a href="#__codelineno-19-243">243</a></span>
<span class="normal"><a href="#__codelineno-19-244">244</a></span>
<span class="normal"><a href="#__codelineno-19-245">245</a></span>
<span class="normal"><a href="#__codelineno-19-246">246</a></span>
<span class="normal"><a href="#__codelineno-19-247">247</a></span>
<span class="normal"><a href="#__codelineno-19-248">248</a></span>
<span class="normal"><a href="#__codelineno-19-249">249</a></span>
<span class="normal"><a href="#__codelineno-19-250">250</a></span>
<span class="normal"><a href="#__codelineno-19-251">251</a></span>
<span class="normal"><a href="#__codelineno-19-252">252</a></span>
<span class="normal"><a href="#__codelineno-19-253">253</a></span>
<span class="normal"><a href="#__codelineno-19-254">254</a></span>
<span class="normal"><a href="#__codelineno-19-255">255</a></span>
<span class="normal"><a href="#__codelineno-19-256">256</a></span>
<span class="normal"><a href="#__codelineno-19-257">257</a></span>
<span class="normal"><a href="#__codelineno-19-258">258</a></span>
<span class="normal"><a href="#__codelineno-19-259">259</a></span>
<span class="normal"><a href="#__codelineno-19-260">260</a></span>
<span class="normal"><a href="#__codelineno-19-261">261</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="cm">/*</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="cm">* Available Macros:</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="cm">*</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="cm">* Passes:</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="cm">* - ALPHA_TEST_PASS</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="cm">* - DEPTH_ONLY_PASS</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="cm">* - DEPTH_ONLY_OPAQUE_PASS</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="cm">* - OPAQUE_PASS</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="cm">* - TRANSPARENT_PASS</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="cm">*</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="cm">* Instancing:</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="cm">* - INSTANCING__OFF (not used)</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="cm">* - INSTANCING__ON</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="cm">*</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="cm">* RenderAsBillboards:</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="cm">* - RENDER_AS_BILLBOARDS__OFF (not used)</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="cm">* - RENDER_AS_BILLBOARDS__ON (not used)</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="cm">*</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="cm">* Seasons:</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="cm">* - SEASONS__OFF</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="cm">* - SEASONS__ON</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="cm">*/</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="err">$</span><span class="kr">input</span><span class="w"> </span><span class="n">v_color0</span><span class="p">,</span><span class="w"> </span><span class="n">v_fog</span><span class="p">,</span><span class="w"> </span><span class="n">v_lightmapUV</span><span class="p">,</span><span class="w"> </span><span class="n">v_texcoord0</span><span class="p">,</span><span class="w"> </span><span class="n">v_worldPos</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="cp">#include &quot;bgfx_shader.sh&quot;</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2D</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="p">}</span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler3D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture3D</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="p">}</span>
<a id="__codelineno-19-34" name="__codelineno-19-34"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">samplerCube</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-35" name="__codelineno-19-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">textureCube</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-19-36" name="__codelineno-19-36"></a><span class="p">}</span>
<a id="__codelineno-19-37" name="__codelineno-19-37"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-38" name="__codelineno-19-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2DLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-19-39" name="__codelineno-19-39"></a><span class="p">}</span>
<a id="__codelineno-19-40" name="__codelineno-19-40"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler3D</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-41" name="__codelineno-19-41"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture3DLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-19-42" name="__codelineno-19-42"></a><span class="p">}</span>
<a id="__codelineno-19-43" name="__codelineno-19-43"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2DArray</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-44" name="__codelineno-19-44"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2DArray</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">);</span>
<a id="__codelineno-19-45" name="__codelineno-19-45"></a><span class="p">}</span>
<a id="__codelineno-19-46" name="__codelineno-19-46"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="k">mediump</span><span class="w"> </span><span class="kt">sampler2DArray</span><span class="w"> </span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">_lod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-47" name="__codelineno-19-47"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">texture2DArrayLod</span><span class="p">(</span><span class="n">_sampler</span><span class="p">,</span><span class="w"> </span><span class="n">_coord</span><span class="p">,</span><span class="w"> </span><span class="n">_lod</span><span class="p">);</span>
<a id="__codelineno-19-48" name="__codelineno-19-48"></a><span class="p">}</span>
<a id="__codelineno-19-49" name="__codelineno-19-49"></a>
<a id="__codelineno-19-50" name="__codelineno-19-50"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FogAndDistanceControl</span><span class="p">;</span>
<a id="__codelineno-19-51" name="__codelineno-19-51"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FogColor</span><span class="p">;</span>
<a id="__codelineno-19-52" name="__codelineno-19-52"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">GlobalRoughness</span><span class="p">;</span>
<a id="__codelineno-19-53" name="__codelineno-19-53"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">LightDiffuseColorAndIlluminance</span><span class="p">;</span>
<a id="__codelineno-19-54" name="__codelineno-19-54"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">LightWorldSpaceDirection</span><span class="p">;</span>
<a id="__codelineno-19-55" name="__codelineno-19-55"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">MaterialID</span><span class="p">;</span>
<a id="__codelineno-19-56" name="__codelineno-19-56"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">RenderChunkFogAlpha</span><span class="p">;</span>
<a id="__codelineno-19-57" name="__codelineno-19-57"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">;</span>
<a id="__codelineno-19-58" name="__codelineno-19-58"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">ViewPositionAndTime</span><span class="p">;</span>
<a id="__codelineno-19-59" name="__codelineno-19-59"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">ViewRect</span><span class="p">;</span>
<a id="__codelineno-19-60" name="__codelineno-19-60"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">Proj</span><span class="p">;</span>
<a id="__codelineno-19-61" name="__codelineno-19-61"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">View</span><span class="p">;</span>
<a id="__codelineno-19-62" name="__codelineno-19-62"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">ViewTexel</span><span class="p">;</span>
<a id="__codelineno-19-63" name="__codelineno-19-63"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">InvView</span><span class="p">;</span>
<a id="__codelineno-19-64" name="__codelineno-19-64"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">InvProj</span><span class="p">;</span>
<a id="__codelineno-19-65" name="__codelineno-19-65"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">ViewProj</span><span class="p">;</span>
<a id="__codelineno-19-66" name="__codelineno-19-66"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">InvViewProj</span><span class="p">;</span>
<a id="__codelineno-19-67" name="__codelineno-19-67"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">PrevViewProj</span><span class="p">;</span>
<a id="__codelineno-19-68" name="__codelineno-19-68"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a id="__codelineno-19-69" name="__codelineno-19-69"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">World</span><span class="p">;</span>
<a id="__codelineno-19-70" name="__codelineno-19-70"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">WorldView</span><span class="p">;</span>
<a id="__codelineno-19-71" name="__codelineno-19-71"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">WorldViewProj</span><span class="p">;</span>
<a id="__codelineno-19-72" name="__codelineno-19-72"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">PrevWorldPosOffset</span><span class="p">;</span>
<a id="__codelineno-19-73" name="__codelineno-19-73"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">AlphaRef4</span><span class="p">;</span>
<a id="__codelineno-19-74" name="__codelineno-19-74"></a><span class="kt">float</span><span class="w"> </span><span class="n">AlphaRef</span><span class="p">;</span>
<a id="__codelineno-19-75" name="__codelineno-19-75"></a>
<a id="__codelineno-19-76" name="__codelineno-19-76"></a><span class="k">struct</span><span class="w"> </span><span class="n">FragmentInput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-77" name="__codelineno-19-77"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">color0</span><span class="p">;</span>
<a id="__codelineno-19-78" name="__codelineno-19-78"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">fog</span><span class="p">;</span>
<a id="__codelineno-19-79" name="__codelineno-19-79"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">lightmapUV</span><span class="p">;</span>
<a id="__codelineno-19-80" name="__codelineno-19-80"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-19-81" name="__codelineno-19-81"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-19-82" name="__codelineno-19-82"></a><span class="p">};</span>
<a id="__codelineno-19-83" name="__codelineno-19-83"></a>
<a id="__codelineno-19-84" name="__codelineno-19-84"></a><span class="k">struct</span><span class="w"> </span><span class="n">FragmentOutput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-85" name="__codelineno-19-85"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">Color0</span><span class="p">;</span>
<a id="__codelineno-19-86" name="__codelineno-19-86"></a><span class="p">};</span>
<a id="__codelineno-19-87" name="__codelineno-19-87"></a>
<a id="__codelineno-19-88" name="__codelineno-19-88"></a><span class="n">SAMPLER2D_AUTOREG</span><span class="p">(</span><span class="n">s_LightMapTexture</span><span class="p">);</span>
<a id="__codelineno-19-89" name="__codelineno-19-89"></a><span class="n">SAMPLER2D_AUTOREG</span><span class="p">(</span><span class="n">s_MatTexture</span><span class="p">);</span>
<a id="__codelineno-19-90" name="__codelineno-19-90"></a><span class="n">SAMPLER2D_AUTOREG</span><span class="p">(</span><span class="n">s_SeasonsTexture</span><span class="p">);</span>
<a id="__codelineno-19-91" name="__codelineno-19-91"></a><span class="k">struct</span><span class="w"> </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-92" name="__codelineno-19-92"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">UV</span><span class="p">;</span>
<a id="__codelineno-19-93" name="__codelineno-19-93"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">Color</span><span class="p">;</span>
<a id="__codelineno-19-94" name="__codelineno-19-94"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Alpha</span><span class="p">;</span>
<a id="__codelineno-19-95" name="__codelineno-19-95"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">lightmapUV</span><span class="p">;</span>
<a id="__codelineno-19-96" name="__codelineno-19-96"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">fog</span><span class="p">;</span>
<a id="__codelineno-19-97" name="__codelineno-19-97"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-19-98" name="__codelineno-19-98"></a><span class="p">};</span>
<a id="__codelineno-19-99" name="__codelineno-19-99"></a>
<a id="__codelineno-19-100" name="__codelineno-19-100"></a><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">StandardTemplate_DefaultInput</span><span class="p">(</span><span class="n">FragmentInput</span><span class="w"> </span><span class="n">fragInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-101" name="__codelineno-19-101"></a><span class="w">    </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-19-102" name="__codelineno-19-102"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">UV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-19-103" name="__codelineno-19-103"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-19-104" name="__codelineno-19-104"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-19-105" name="__codelineno-19-105"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">lightmapUV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="p">;</span>
<a id="__codelineno-19-106" name="__codelineno-19-106"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">fog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">fog</span><span class="p">;</span>
<a id="__codelineno-19-107" name="__codelineno-19-107"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">texcoord0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-19-108" name="__codelineno-19-108"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-19-109" name="__codelineno-19-109"></a><span class="p">}</span>
<a id="__codelineno-19-110" name="__codelineno-19-110"></a><span class="k">struct</span><span class="w"> </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-111" name="__codelineno-19-111"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">Albedo</span><span class="p">;</span>
<a id="__codelineno-19-112" name="__codelineno-19-112"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Alpha</span><span class="p">;</span>
<a id="__codelineno-19-113" name="__codelineno-19-113"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Metallic</span><span class="p">;</span>
<a id="__codelineno-19-114" name="__codelineno-19-114"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Roughness</span><span class="p">;</span>
<a id="__codelineno-19-115" name="__codelineno-19-115"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Occlusion</span><span class="p">;</span>
<a id="__codelineno-19-116" name="__codelineno-19-116"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Emissive</span><span class="p">;</span>
<a id="__codelineno-19-117" name="__codelineno-19-117"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">Subsurface</span><span class="p">;</span>
<a id="__codelineno-19-118" name="__codelineno-19-118"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">AmbientLight</span><span class="p">;</span>
<a id="__codelineno-19-119" name="__codelineno-19-119"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">ViewSpaceNormal</span><span class="p">;</span>
<a id="__codelineno-19-120" name="__codelineno-19-120"></a><span class="p">};</span>
<a id="__codelineno-19-121" name="__codelineno-19-121"></a>
<a id="__codelineno-19-122" name="__codelineno-19-122"></a><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">StandardTemplate_DefaultOutput</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-123" name="__codelineno-19-123"></a><span class="w">    </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-19-124" name="__codelineno-19-124"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-19-125" name="__codelineno-19-125"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-19-126" name="__codelineno-19-126"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Metallic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-19-127" name="__codelineno-19-127"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-19-128" name="__codelineno-19-128"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Occlusion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-19-129" name="__codelineno-19-129"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Emissive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-19-130" name="__codelineno-19-130"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">Subsurface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-19-131" name="__codelineno-19-131"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">AmbientLight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-19-132" name="__codelineno-19-132"></a><span class="w">    </span><span class="n">result</span><span class="p">.</span><span class="n">ViewSpaceNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-19-133" name="__codelineno-19-133"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-19-134" name="__codelineno-19-134"></a><span class="p">}</span>
<a id="__codelineno-19-135" name="__codelineno-19-135"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">applyFogVanilla</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">fogColor</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">fogIntensity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-136" name="__codelineno-19-136"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mix</span><span class="p">(</span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="n">fogColor</span><span class="p">,</span><span class="w"> </span><span class="n">fogIntensity</span><span class="p">);</span>
<a id="__codelineno-19-137" name="__codelineno-19-137"></a><span class="p">}</span>
<a id="__codelineno-19-138" name="__codelineno-19-138"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">applySeasons</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">vertexColor</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">vertexAlpha</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">diffuse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-139" name="__codelineno-19-139"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">uv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertexColor</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
<a id="__codelineno-19-140" name="__codelineno-19-140"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">mix</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">),</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="n">s_SeasonsTexture</span><span class="p">,</span><span class="w"> </span><span class="n">uv</span><span class="p">).</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span><span class="w"> </span><span class="n">vertexColor</span><span class="p">.</span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-19-141" name="__codelineno-19-141"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">vec3_splat</span><span class="p">(</span><span class="n">vertexAlpha</span><span class="p">);</span>
<a id="__codelineno-19-142" name="__codelineno-19-142"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-19-143" name="__codelineno-19-143"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">diffuse</span><span class="p">;</span>
<a id="__codelineno-19-144" name="__codelineno-19-144"></a><span class="p">}</span>
<a id="__codelineno-19-145" name="__codelineno-19-145"></a><span class="kt">void</span><span class="w"> </span><span class="n">RenderChunkApplyFog</span><span class="p">(</span><span class="n">FragmentInput</span><span class="w"> </span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">FragmentOutput</span><span class="w"> </span><span class="n">fragOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-146" name="__codelineno-19-146"></a><span class="w">    </span><span class="n">fragOutput</span><span class="p">.</span><span class="n">Color0</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applyFogVanilla</span><span class="p">(</span><span class="n">fragOutput</span><span class="p">.</span><span class="n">Color0</span><span class="p">.</span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="n">FogColor</span><span class="p">.</span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">fog</span><span class="p">.</span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-19-147" name="__codelineno-19-147"></a><span class="p">}</span>
<a id="__codelineno-19-148" name="__codelineno-19-148"></a><span class="kt">void</span><span class="w"> </span><span class="n">RenderChunkSurfTransparent</span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-149" name="__codelineno-19-149"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="n">s_MatTexture</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">UV</span><span class="p">);</span>
<a id="__codelineno-19-150" name="__codelineno-19-150"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Alpha</span><span class="p">;</span>
<a id="__codelineno-19-151" name="__codelineno-19-151"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Color</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-19-152" name="__codelineno-19-152"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-19-153" name="__codelineno-19-153"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diffuse</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-19-154" name="__codelineno-19-154"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobalRoughness</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-19-155" name="__codelineno-19-155"></a><span class="p">}</span>
<a id="__codelineno-19-156" name="__codelineno-19-156"></a><span class="k">struct</span><span class="w"> </span><span class="n">CompositingOutput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-157" name="__codelineno-19-157"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">mLitColor</span><span class="p">;</span>
<a id="__codelineno-19-158" name="__codelineno-19-158"></a><span class="p">};</span>
<a id="__codelineno-19-159" name="__codelineno-19-159"></a>
<a id="__codelineno-19-160" name="__codelineno-19-160"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">standardComposite</span><span class="p">(</span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">stdOutput</span><span class="p">,</span><span class="w"> </span><span class="n">CompositingOutput</span><span class="w"> </span><span class="n">compositingOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-161" name="__codelineno-19-161"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">compositingOutput</span><span class="p">.</span><span class="n">mLitColor</span><span class="p">,</span><span class="w"> </span><span class="n">stdOutput</span><span class="p">.</span><span class="n">Alpha</span><span class="p">);</span>
<a id="__codelineno-19-162" name="__codelineno-19-162"></a><span class="p">}</span>
<a id="__codelineno-19-163" name="__codelineno-19-163"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_CustomSurfaceShaderEntryIdentity</span><span class="p">(</span><span class="kt">vec2</span><span class="w"> </span><span class="n">uv</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-164" name="__codelineno-19-164"></a><span class="p">}</span>
<a id="__codelineno-19-165" name="__codelineno-19-165"></a><span class="k">struct</span><span class="w"> </span><span class="n">DirectionalLight</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-166" name="__codelineno-19-166"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">ViewSpaceDirection</span><span class="p">;</span>
<a id="__codelineno-19-167" name="__codelineno-19-167"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">Intensity</span><span class="p">;</span>
<a id="__codelineno-19-168" name="__codelineno-19-168"></a><span class="p">};</span>
<a id="__codelineno-19-169" name="__codelineno-19-169"></a>
<a id="__codelineno-19-170" name="__codelineno-19-170"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">computeLighting_RenderChunk</span><span class="p">(</span><span class="n">FragmentInput</span><span class="w"> </span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">stdOutput</span><span class="p">,</span><span class="w"> </span><span class="n">DirectionalLight</span><span class="w"> </span><span class="n">primaryLight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-171" name="__codelineno-19-171"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="n">s_LightMapTexture</span><span class="p">,</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="p">).</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">stdOutput</span><span class="p">.</span><span class="n">Albedo</span><span class="p">;</span>
<a id="__codelineno-19-172" name="__codelineno-19-172"></a><span class="p">}</span>
<a id="__codelineno-19-173" name="__codelineno-19-173"></a><span class="kt">void</span><span class="w"> </span><span class="n">RenderChunkSurfAlpha</span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-174" name="__codelineno-19-174"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="n">s_MatTexture</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">UV</span><span class="p">);</span>
<a id="__codelineno-19-175" name="__codelineno-19-175"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">ALPHA_THRESHOLD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-19-176" name="__codelineno-19-176"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">diffuse</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ALPHA_THRESHOLD</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-177" name="__codelineno-19-177"></a><span class="w">        </span><span class="k">discard</span><span class="p">;</span>
<a id="__codelineno-19-178" name="__codelineno-19-178"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-179" name="__codelineno-19-179"></a><span class="w">    </span><span class="cp">#ifdef ALPHA_TEST_PASS</span>
<a id="__codelineno-19-180" name="__codelineno-19-180"></a><span class="w">    </span><span class="cp">#ifdef SEASONS__ON</span>
<a id="__codelineno-19-181" name="__codelineno-19-181"></a><span class="w">    </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applySeasons</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Color</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Alpha</span><span class="p">,</span><span class="w"> </span><span class="n">diffuse</span><span class="p">);</span>
<a id="__codelineno-19-182" name="__codelineno-19-182"></a><span class="w">    </span><span class="cp">#else</span>
<a id="__codelineno-19-183" name="__codelineno-19-183"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Color</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-19-184" name="__codelineno-19-184"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-19-185" name="__codelineno-19-185"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-19-186" name="__codelineno-19-186"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diffuse</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-19-187" name="__codelineno-19-187"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobalRoughness</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-19-188" name="__codelineno-19-188"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-19-189" name="__codelineno-19-189"></a><span class="p">}</span>
<a id="__codelineno-19-190" name="__codelineno-19-190"></a><span class="kt">void</span><span class="w"> </span><span class="n">RenderChunkSurfOpaque</span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-191" name="__codelineno-19-191"></a><span class="w">    </span><span class="cp">#ifdef OPAQUE_PASS</span>
<a id="__codelineno-19-192" name="__codelineno-19-192"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textureSample</span><span class="p">(</span><span class="n">s_MatTexture</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">UV</span><span class="p">);</span>
<a id="__codelineno-19-193" name="__codelineno-19-193"></a>
<a id="__codelineno-19-194" name="__codelineno-19-194"></a><span class="w">    </span><span class="cp">#ifdef SEASONS__ON</span>
<a id="__codelineno-19-195" name="__codelineno-19-195"></a><span class="w">    </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">applySeasons</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Color</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Alpha</span><span class="p">,</span><span class="w"> </span><span class="n">diffuse</span><span class="p">);</span>
<a id="__codelineno-19-196" name="__codelineno-19-196"></a><span class="w">    </span><span class="cp">#else</span>
<a id="__codelineno-19-197" name="__codelineno-19-197"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Color</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-19-198" name="__codelineno-19-198"></a><span class="w">    </span><span class="n">diffuse</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Alpha</span><span class="p">;</span>
<a id="__codelineno-19-199" name="__codelineno-19-199"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-19-200" name="__codelineno-19-200"></a>
<a id="__codelineno-19-201" name="__codelineno-19-201"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diffuse</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-19-202" name="__codelineno-19-202"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diffuse</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-19-203" name="__codelineno-19-203"></a><span class="w">    </span><span class="n">surfaceOutput</span><span class="p">.</span><span class="n">Roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobalRoughness</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-19-204" name="__codelineno-19-204"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-19-205" name="__codelineno-19-205"></a><span class="p">}</span>
<a id="__codelineno-19-206" name="__codelineno-19-206"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_Opaque_Frag</span><span class="p">(</span><span class="n">FragmentInput</span><span class="w"> </span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">FragmentOutput</span><span class="w"> </span><span class="n">fragOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-207" name="__codelineno-19-207"></a><span class="w">    </span><span class="n">StandardSurfaceInput</span><span class="w"> </span><span class="n">surfaceInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StandardTemplate_DefaultInput</span><span class="p">(</span><span class="n">fragInput</span><span class="p">);</span>
<a id="__codelineno-19-208" name="__codelineno-19-208"></a><span class="w">    </span><span class="n">StandardSurfaceOutput</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StandardTemplate_DefaultOutput</span><span class="p">();</span>
<a id="__codelineno-19-209" name="__codelineno-19-209"></a><span class="w">    </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">UV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-19-210" name="__codelineno-19-210"></a><span class="w">    </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-19-211" name="__codelineno-19-211"></a><span class="w">    </span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">Alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-19-212" name="__codelineno-19-212"></a><span class="w">    </span><span class="cp">#ifdef TRANSPARENT_PASS</span>
<a id="__codelineno-19-213" name="__codelineno-19-213"></a><span class="w">    </span><span class="n">RenderChunkSurfTransparent</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-19-214" name="__codelineno-19-214"></a><span class="w">    </span><span class="cp">#elif defined(ALPHA_TEST_PASS)|| defined(DEPTH_ONLY_PASS)</span>
<a id="__codelineno-19-215" name="__codelineno-19-215"></a><span class="w">    </span><span class="n">RenderChunkSurfAlpha</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-19-216" name="__codelineno-19-216"></a><span class="w">    </span><span class="cp">#elif defined(DEPTH_ONLY_OPAQUE_PASS)|| defined(OPAQUE_PASS)</span>
<a id="__codelineno-19-217" name="__codelineno-19-217"></a><span class="w">    </span><span class="n">RenderChunkSurfOpaque</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-19-218" name="__codelineno-19-218"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-19-219" name="__codelineno-19-219"></a><span class="w">    </span><span class="n">StandardTemplate_CustomSurfaceShaderEntryIdentity</span><span class="p">(</span><span class="n">surfaceInput</span><span class="p">.</span><span class="n">UV</span><span class="p">,</span><span class="w"> </span><span class="n">fragInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">);</span>
<a id="__codelineno-19-220" name="__codelineno-19-220"></a><span class="w">    </span><span class="n">DirectionalLight</span><span class="w"> </span><span class="n">primaryLight</span><span class="p">;</span>
<a id="__codelineno-19-221" name="__codelineno-19-221"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldLightDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LightWorldSpaceDirection</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-19-222" name="__codelineno-19-222"></a><span class="w">    </span><span class="n">primaryLight</span><span class="p">.</span><span class="n">ViewSpaceDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">View</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">worldLightDirection</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-19-223" name="__codelineno-19-223"></a><span class="w">    </span><span class="n">primaryLight</span><span class="p">.</span><span class="n">Intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LightDiffuseColorAndIlluminance</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">LightDiffuseColorAndIlluminance</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-19-224" name="__codelineno-19-224"></a><span class="w">    </span><span class="n">CompositingOutput</span><span class="w"> </span><span class="n">compositingOutput</span><span class="p">;</span>
<a id="__codelineno-19-225" name="__codelineno-19-225"></a><span class="w">    </span><span class="n">compositingOutput</span><span class="p">.</span><span class="n">mLitColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">computeLighting_RenderChunk</span><span class="p">(</span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">,</span><span class="w"> </span><span class="n">primaryLight</span><span class="p">);</span>
<a id="__codelineno-19-226" name="__codelineno-19-226"></a><span class="w">    </span><span class="n">fragOutput</span><span class="p">.</span><span class="n">Color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">standardComposite</span><span class="p">(</span><span class="n">surfaceOutput</span><span class="p">,</span><span class="w"> </span><span class="n">compositingOutput</span><span class="p">);</span>
<a id="__codelineno-19-227" name="__codelineno-19-227"></a><span class="w">    </span><span class="n">RenderChunkApplyFog</span><span class="p">(</span><span class="n">fragInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceInput</span><span class="p">,</span><span class="w"> </span><span class="n">surfaceOutput</span><span class="p">,</span><span class="w"> </span><span class="n">fragOutput</span><span class="p">);</span>
<a id="__codelineno-19-228" name="__codelineno-19-228"></a><span class="p">}</span>
<a id="__codelineno-19-229" name="__codelineno-19-229"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-230" name="__codelineno-19-230"></a><span class="w">    </span><span class="n">FragmentInput</span><span class="w"> </span><span class="n">fragmentInput</span><span class="p">;</span>
<a id="__codelineno-19-231" name="__codelineno-19-231"></a><span class="w">    </span><span class="n">FragmentOutput</span><span class="w"> </span><span class="n">fragmentOutput</span><span class="p">;</span>
<a id="__codelineno-19-232" name="__codelineno-19-232"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_color0</span><span class="p">;</span>
<a id="__codelineno-19-233" name="__codelineno-19-233"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">fog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_fog</span><span class="p">;</span>
<a id="__codelineno-19-234" name="__codelineno-19-234"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_lightmapUV</span><span class="p">;</span>
<a id="__codelineno-19-235" name="__codelineno-19-235"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">texcoord0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_texcoord0</span><span class="p">;</span>
<a id="__codelineno-19-236" name="__codelineno-19-236"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_worldPos</span><span class="p">;</span>
<a id="__codelineno-19-237" name="__codelineno-19-237"></a><span class="w">    </span><span class="n">fragmentOutput</span><span class="p">.</span><span class="n">Color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-19-238" name="__codelineno-19-238"></a><span class="w">    </span><span class="n">ViewRect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewRect</span><span class="p">;</span>
<a id="__codelineno-19-239" name="__codelineno-19-239"></a><span class="w">    </span><span class="n">Proj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_proj</span><span class="p">;</span>
<a id="__codelineno-19-240" name="__codelineno-19-240"></a><span class="w">    </span><span class="n">View</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_view</span><span class="p">;</span>
<a id="__codelineno-19-241" name="__codelineno-19-241"></a><span class="w">    </span><span class="n">ViewTexel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewTexel</span><span class="p">;</span>
<a id="__codelineno-19-242" name="__codelineno-19-242"></a><span class="w">    </span><span class="n">InvView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invView</span><span class="p">;</span>
<a id="__codelineno-19-243" name="__codelineno-19-243"></a><span class="w">    </span><span class="n">InvProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invProj</span><span class="p">;</span>
<a id="__codelineno-19-244" name="__codelineno-19-244"></a><span class="w">    </span><span class="n">ViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewProj</span><span class="p">;</span>
<a id="__codelineno-19-245" name="__codelineno-19-245"></a><span class="w">    </span><span class="n">InvViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invViewProj</span><span class="p">;</span>
<a id="__codelineno-19-246" name="__codelineno-19-246"></a><span class="w">    </span><span class="n">PrevViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_prevViewProj</span><span class="p">;</span>
<a id="__codelineno-19-247" name="__codelineno-19-247"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-19-248" name="__codelineno-19-248"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mo">0</span><span class="p">];</span>
<a id="__codelineno-19-249" name="__codelineno-19-249"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-19-250" name="__codelineno-19-250"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-19-251" name="__codelineno-19-251"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-19-252" name="__codelineno-19-252"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-253" name="__codelineno-19-253"></a><span class="w">    </span><span class="n">World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mo">0</span><span class="p">];</span>
<a id="__codelineno-19-254" name="__codelineno-19-254"></a><span class="w">    </span><span class="n">WorldView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_modelView</span><span class="p">;</span>
<a id="__codelineno-19-255" name="__codelineno-19-255"></a><span class="w">    </span><span class="n">WorldViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_modelViewProj</span><span class="p">;</span>
<a id="__codelineno-19-256" name="__codelineno-19-256"></a><span class="w">    </span><span class="n">PrevWorldPosOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_prevWorldPosOffset</span><span class="p">;</span>
<a id="__codelineno-19-257" name="__codelineno-19-257"></a><span class="w">    </span><span class="n">AlphaRef4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_alphaRef4</span><span class="p">;</span>
<a id="__codelineno-19-258" name="__codelineno-19-258"></a><span class="w">    </span><span class="n">AlphaRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_alphaRef4</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-19-259" name="__codelineno-19-259"></a><span class="w">    </span><span class="n">StandardTemplate_Opaque_Frag</span><span class="p">(</span><span class="n">fragmentInput</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentOutput</span><span class="p">);</span>
<a id="__codelineno-19-260" name="__codelineno-19-260"></a><span class="w">    </span><span class="nb">gl_FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragmentOutput</span><span class="p">.</span><span class="n">Color0</span><span class="p">;</span>
<a id="__codelineno-19-261" name="__codelineno-19-261"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<details class="info">
<summary>vertex.sc</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">vertex.sc</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">  1</a></span>
<span class="normal"><a href="#__codelineno-20-2">  2</a></span>
<span class="normal"><a href="#__codelineno-20-3">  3</a></span>
<span class="normal"><a href="#__codelineno-20-4">  4</a></span>
<span class="normal"><a href="#__codelineno-20-5">  5</a></span>
<span class="normal"><a href="#__codelineno-20-6">  6</a></span>
<span class="normal"><a href="#__codelineno-20-7">  7</a></span>
<span class="normal"><a href="#__codelineno-20-8">  8</a></span>
<span class="normal"><a href="#__codelineno-20-9">  9</a></span>
<span class="normal"><a href="#__codelineno-20-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-20-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-20-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-20-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-20-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-20-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-20-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-20-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-20-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-20-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-20-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-20-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-20-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-20-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-20-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-20-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-20-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-20-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-20-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-20-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-20-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-20-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-20-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-20-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-20-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-20-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-20-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-20-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-20-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-20-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-20-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-20-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-20-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-20-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-20-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-20-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-20-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-20-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-20-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-20-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-20-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-20-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-20-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-20-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-20-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-20-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-20-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-20-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-20-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-20-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-20-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-20-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-20-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-20-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-20-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-20-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-20-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-20-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-20-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-20-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-20-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-20-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-20-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-20-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-20-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-20-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-20-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-20-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-20-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-20-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-20-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-20-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-20-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-20-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-20-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-20-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-20-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-20-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-20-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-20-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-20-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-20-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-20-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-20-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-20-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-20-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-20-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-20-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-20-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-20-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-20-100">100</a></span>
<span class="normal"><a href="#__codelineno-20-101">101</a></span>
<span class="normal"><a href="#__codelineno-20-102">102</a></span>
<span class="normal"><a href="#__codelineno-20-103">103</a></span>
<span class="normal"><a href="#__codelineno-20-104">104</a></span>
<span class="normal"><a href="#__codelineno-20-105">105</a></span>
<span class="normal"><a href="#__codelineno-20-106">106</a></span>
<span class="normal"><a href="#__codelineno-20-107">107</a></span>
<span class="normal"><a href="#__codelineno-20-108">108</a></span>
<span class="normal"><a href="#__codelineno-20-109">109</a></span>
<span class="normal"><a href="#__codelineno-20-110">110</a></span>
<span class="normal"><a href="#__codelineno-20-111">111</a></span>
<span class="normal"><a href="#__codelineno-20-112">112</a></span>
<span class="normal"><a href="#__codelineno-20-113">113</a></span>
<span class="normal"><a href="#__codelineno-20-114">114</a></span>
<span class="normal"><a href="#__codelineno-20-115">115</a></span>
<span class="normal"><a href="#__codelineno-20-116">116</a></span>
<span class="normal"><a href="#__codelineno-20-117">117</a></span>
<span class="normal"><a href="#__codelineno-20-118">118</a></span>
<span class="normal"><a href="#__codelineno-20-119">119</a></span>
<span class="normal"><a href="#__codelineno-20-120">120</a></span>
<span class="normal"><a href="#__codelineno-20-121">121</a></span>
<span class="normal"><a href="#__codelineno-20-122">122</a></span>
<span class="normal"><a href="#__codelineno-20-123">123</a></span>
<span class="normal"><a href="#__codelineno-20-124">124</a></span>
<span class="normal"><a href="#__codelineno-20-125">125</a></span>
<span class="normal"><a href="#__codelineno-20-126">126</a></span>
<span class="normal"><a href="#__codelineno-20-127">127</a></span>
<span class="normal"><a href="#__codelineno-20-128">128</a></span>
<span class="normal"><a href="#__codelineno-20-129">129</a></span>
<span class="normal"><a href="#__codelineno-20-130">130</a></span>
<span class="normal"><a href="#__codelineno-20-131">131</a></span>
<span class="normal"><a href="#__codelineno-20-132">132</a></span>
<span class="normal"><a href="#__codelineno-20-133">133</a></span>
<span class="normal"><a href="#__codelineno-20-134">134</a></span>
<span class="normal"><a href="#__codelineno-20-135">135</a></span>
<span class="normal"><a href="#__codelineno-20-136">136</a></span>
<span class="normal"><a href="#__codelineno-20-137">137</a></span>
<span class="normal"><a href="#__codelineno-20-138">138</a></span>
<span class="normal"><a href="#__codelineno-20-139">139</a></span>
<span class="normal"><a href="#__codelineno-20-140">140</a></span>
<span class="normal"><a href="#__codelineno-20-141">141</a></span>
<span class="normal"><a href="#__codelineno-20-142">142</a></span>
<span class="normal"><a href="#__codelineno-20-143">143</a></span>
<span class="normal"><a href="#__codelineno-20-144">144</a></span>
<span class="normal"><a href="#__codelineno-20-145">145</a></span>
<span class="normal"><a href="#__codelineno-20-146">146</a></span>
<span class="normal"><a href="#__codelineno-20-147">147</a></span>
<span class="normal"><a href="#__codelineno-20-148">148</a></span>
<span class="normal"><a href="#__codelineno-20-149">149</a></span>
<span class="normal"><a href="#__codelineno-20-150">150</a></span>
<span class="normal"><a href="#__codelineno-20-151">151</a></span>
<span class="normal"><a href="#__codelineno-20-152">152</a></span>
<span class="normal"><a href="#__codelineno-20-153">153</a></span>
<span class="normal"><a href="#__codelineno-20-154">154</a></span>
<span class="normal"><a href="#__codelineno-20-155">155</a></span>
<span class="normal"><a href="#__codelineno-20-156">156</a></span>
<span class="normal"><a href="#__codelineno-20-157">157</a></span>
<span class="normal"><a href="#__codelineno-20-158">158</a></span>
<span class="normal"><a href="#__codelineno-20-159">159</a></span>
<span class="normal"><a href="#__codelineno-20-160">160</a></span>
<span class="normal"><a href="#__codelineno-20-161">161</a></span>
<span class="normal"><a href="#__codelineno-20-162">162</a></span>
<span class="normal"><a href="#__codelineno-20-163">163</a></span>
<span class="normal"><a href="#__codelineno-20-164">164</a></span>
<span class="normal"><a href="#__codelineno-20-165">165</a></span>
<span class="normal"><a href="#__codelineno-20-166">166</a></span>
<span class="normal"><a href="#__codelineno-20-167">167</a></span>
<span class="normal"><a href="#__codelineno-20-168">168</a></span>
<span class="normal"><a href="#__codelineno-20-169">169</a></span>
<span class="normal"><a href="#__codelineno-20-170">170</a></span>
<span class="normal"><a href="#__codelineno-20-171">171</a></span>
<span class="normal"><a href="#__codelineno-20-172">172</a></span>
<span class="normal"><a href="#__codelineno-20-173">173</a></span>
<span class="normal"><a href="#__codelineno-20-174">174</a></span>
<span class="normal"><a href="#__codelineno-20-175">175</a></span>
<span class="normal"><a href="#__codelineno-20-176">176</a></span>
<span class="normal"><a href="#__codelineno-20-177">177</a></span>
<span class="normal"><a href="#__codelineno-20-178">178</a></span>
<span class="normal"><a href="#__codelineno-20-179">179</a></span>
<span class="normal"><a href="#__codelineno-20-180">180</a></span>
<span class="normal"><a href="#__codelineno-20-181">181</a></span>
<span class="normal"><a href="#__codelineno-20-182">182</a></span>
<span class="normal"><a href="#__codelineno-20-183">183</a></span>
<span class="normal"><a href="#__codelineno-20-184">184</a></span>
<span class="normal"><a href="#__codelineno-20-185">185</a></span>
<span class="normal"><a href="#__codelineno-20-186">186</a></span>
<span class="normal"><a href="#__codelineno-20-187">187</a></span>
<span class="normal"><a href="#__codelineno-20-188">188</a></span>
<span class="normal"><a href="#__codelineno-20-189">189</a></span>
<span class="normal"><a href="#__codelineno-20-190">190</a></span>
<span class="normal"><a href="#__codelineno-20-191">191</a></span>
<span class="normal"><a href="#__codelineno-20-192">192</a></span>
<span class="normal"><a href="#__codelineno-20-193">193</a></span>
<span class="normal"><a href="#__codelineno-20-194">194</a></span>
<span class="normal"><a href="#__codelineno-20-195">195</a></span>
<span class="normal"><a href="#__codelineno-20-196">196</a></span>
<span class="normal"><a href="#__codelineno-20-197">197</a></span>
<span class="normal"><a href="#__codelineno-20-198">198</a></span>
<span class="normal"><a href="#__codelineno-20-199">199</a></span>
<span class="normal"><a href="#__codelineno-20-200">200</a></span>
<span class="normal"><a href="#__codelineno-20-201">201</a></span>
<span class="normal"><a href="#__codelineno-20-202">202</a></span>
<span class="normal"><a href="#__codelineno-20-203">203</a></span>
<span class="normal"><a href="#__codelineno-20-204">204</a></span>
<span class="normal"><a href="#__codelineno-20-205">205</a></span>
<span class="normal"><a href="#__codelineno-20-206">206</a></span>
<span class="normal"><a href="#__codelineno-20-207">207</a></span>
<span class="normal"><a href="#__codelineno-20-208">208</a></span>
<span class="normal"><a href="#__codelineno-20-209">209</a></span>
<span class="normal"><a href="#__codelineno-20-210">210</a></span>
<span class="normal"><a href="#__codelineno-20-211">211</a></span>
<span class="normal"><a href="#__codelineno-20-212">212</a></span>
<span class="normal"><a href="#__codelineno-20-213">213</a></span>
<span class="normal"><a href="#__codelineno-20-214">214</a></span>
<span class="normal"><a href="#__codelineno-20-215">215</a></span>
<span class="normal"><a href="#__codelineno-20-216">216</a></span>
<span class="normal"><a href="#__codelineno-20-217">217</a></span>
<span class="normal"><a href="#__codelineno-20-218">218</a></span>
<span class="normal"><a href="#__codelineno-20-219">219</a></span>
<span class="normal"><a href="#__codelineno-20-220">220</a></span>
<span class="normal"><a href="#__codelineno-20-221">221</a></span>
<span class="normal"><a href="#__codelineno-20-222">222</a></span>
<span class="normal"><a href="#__codelineno-20-223">223</a></span>
<span class="normal"><a href="#__codelineno-20-224">224</a></span>
<span class="normal"><a href="#__codelineno-20-225">225</a></span>
<span class="normal"><a href="#__codelineno-20-226">226</a></span>
<span class="normal"><a href="#__codelineno-20-227">227</a></span>
<span class="normal"><a href="#__codelineno-20-228">228</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="cm">/*</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="cm">* Available Macros:</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="cm">*</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="cm">* Passes:</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="cm">* - ALPHA_TEST_PASS (not used)</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="cm">* - DEPTH_ONLY_PASS (not used)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="cm">* - DEPTH_ONLY_OPAQUE_PASS (not used)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="cm">* - OPAQUE_PASS (not used)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="cm">* - TRANSPARENT_PASS</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="cm">*</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="cm">* Instancing:</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="cm">* - INSTANCING__OFF</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="cm">* - INSTANCING__ON</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="cm">*</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="cm">* RenderAsBillboards:</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="cm">* - RENDER_AS_BILLBOARDS__OFF (not used)</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="cm">* - RENDER_AS_BILLBOARDS__ON</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="cm">*</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="cm">* Seasons:</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="cm">* - SEASONS__OFF (not used)</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="cm">* - SEASONS__ON (not used)</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="cm">*/</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="err">$</span><span class="kr">input</span><span class="w"> </span><span class="n">a_color0</span><span class="p">,</span><span class="w"> </span><span class="n">a_position</span><span class="p">,</span><span class="w"> </span><span class="n">a_texcoord0</span><span class="p">,</span><span class="w"> </span><span class="n">a_texcoord1</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="cp">#ifdef INSTANCING__ON</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="err">$</span><span class="kr">input</span><span class="w"> </span><span class="n">i_data1</span><span class="p">,</span><span class="w"> </span><span class="n">i_data2</span><span class="p">,</span><span class="w"> </span><span class="n">i_data3</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="cp">#endif</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="err">$</span><span class="kr">output</span><span class="w"> </span><span class="n">v_color0</span><span class="p">,</span><span class="w"> </span><span class="n">v_fog</span><span class="p">,</span><span class="w"> </span><span class="n">v_lightmapUV</span><span class="p">,</span><span class="w"> </span><span class="n">v_texcoord0</span><span class="p">,</span><span class="w"> </span><span class="n">v_worldPos</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a><span class="cp">#include &quot;bgfx_shader.sh&quot;</span>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FogAndDistanceControl</span><span class="p">;</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FogColor</span><span class="p">;</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">GlobalRoughness</span><span class="p">;</span>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">LightDiffuseColorAndIlluminance</span><span class="p">;</span>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">LightWorldSpaceDirection</span><span class="p">;</span>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">MaterialID</span><span class="p">;</span>
<a id="__codelineno-20-39" name="__codelineno-20-39"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">RenderChunkFogAlpha</span><span class="p">;</span>
<a id="__codelineno-20-40" name="__codelineno-20-40"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">;</span>
<a id="__codelineno-20-41" name="__codelineno-20-41"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">ViewPositionAndTime</span><span class="p">;</span>
<a id="__codelineno-20-42" name="__codelineno-20-42"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">ViewRect</span><span class="p">;</span>
<a id="__codelineno-20-43" name="__codelineno-20-43"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">Proj</span><span class="p">;</span>
<a id="__codelineno-20-44" name="__codelineno-20-44"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">View</span><span class="p">;</span>
<a id="__codelineno-20-45" name="__codelineno-20-45"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">ViewTexel</span><span class="p">;</span>
<a id="__codelineno-20-46" name="__codelineno-20-46"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">InvView</span><span class="p">;</span>
<a id="__codelineno-20-47" name="__codelineno-20-47"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">InvProj</span><span class="p">;</span>
<a id="__codelineno-20-48" name="__codelineno-20-48"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">ViewProj</span><span class="p">;</span>
<a id="__codelineno-20-49" name="__codelineno-20-49"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">InvViewProj</span><span class="p">;</span>
<a id="__codelineno-20-50" name="__codelineno-20-50"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">PrevViewProj</span><span class="p">;</span>
<a id="__codelineno-20-51" name="__codelineno-20-51"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<a id="__codelineno-20-52" name="__codelineno-20-52"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">World</span><span class="p">;</span>
<a id="__codelineno-20-53" name="__codelineno-20-53"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">WorldView</span><span class="p">;</span>
<a id="__codelineno-20-54" name="__codelineno-20-54"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">WorldViewProj</span><span class="p">;</span>
<a id="__codelineno-20-55" name="__codelineno-20-55"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">PrevWorldPosOffset</span><span class="p">;</span>
<a id="__codelineno-20-56" name="__codelineno-20-56"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">AlphaRef4</span><span class="p">;</span>
<a id="__codelineno-20-57" name="__codelineno-20-57"></a><span class="kt">float</span><span class="w"> </span><span class="n">AlphaRef</span><span class="p">;</span>
<a id="__codelineno-20-58" name="__codelineno-20-58"></a>
<a id="__codelineno-20-59" name="__codelineno-20-59"></a><span class="k">struct</span><span class="w"> </span><span class="n">VertexInput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-60" name="__codelineno-20-60"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">color0</span><span class="p">;</span>
<a id="__codelineno-20-61" name="__codelineno-20-61"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">lightmapUV</span><span class="p">;</span>
<a id="__codelineno-20-62" name="__codelineno-20-62"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-20-63" name="__codelineno-20-63"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-20-64" name="__codelineno-20-64"></a><span class="w">    </span><span class="cp">#ifdef INSTANCING__ON</span>
<a id="__codelineno-20-65" name="__codelineno-20-65"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">instanceData0</span><span class="p">;</span>
<a id="__codelineno-20-66" name="__codelineno-20-66"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">instanceData1</span><span class="p">;</span>
<a id="__codelineno-20-67" name="__codelineno-20-67"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">instanceData2</span><span class="p">;</span>
<a id="__codelineno-20-68" name="__codelineno-20-68"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-20-69" name="__codelineno-20-69"></a><span class="p">};</span>
<a id="__codelineno-20-70" name="__codelineno-20-70"></a>
<a id="__codelineno-20-71" name="__codelineno-20-71"></a><span class="k">struct</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-72" name="__codelineno-20-72"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-20-73" name="__codelineno-20-73"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">color0</span><span class="p">;</span>
<a id="__codelineno-20-74" name="__codelineno-20-74"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">fog</span><span class="p">;</span>
<a id="__codelineno-20-75" name="__codelineno-20-75"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">lightmapUV</span><span class="p">;</span>
<a id="__codelineno-20-76" name="__codelineno-20-76"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-20-77" name="__codelineno-20-77"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-20-78" name="__codelineno-20-78"></a><span class="p">};</span>
<a id="__codelineno-20-79" name="__codelineno-20-79"></a>
<a id="__codelineno-20-80" name="__codelineno-20-80"></a><span class="k">struct</span><span class="w"> </span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-81" name="__codelineno-20-81"></a><span class="w">    </span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">;</span>
<a id="__codelineno-20-82" name="__codelineno-20-82"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-20-83" name="__codelineno-20-83"></a><span class="p">};</span>
<a id="__codelineno-20-84" name="__codelineno-20-84"></a>
<a id="__codelineno-20-85" name="__codelineno-20-85"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">jitterVertexPosition</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-86" name="__codelineno-20-86"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">offsetProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Proj</span><span class="p">;</span>
<a id="__codelineno-20-87" name="__codelineno-20-87"></a><span class="w">    </span><span class="cp">#if BGFX_SHADER_LANGUAGE_GLSL</span>
<a id="__codelineno-20-88" name="__codelineno-20-88"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-20-89" name="__codelineno-20-89"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-20-90" name="__codelineno-20-90"></a><span class="w">    </span><span class="cp">#else</span>
<a id="__codelineno-20-91" name="__codelineno-20-91"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mo">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-20-92" name="__codelineno-20-92"></a><span class="w">    </span><span class="n">offsetProj</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">SubPixelOffset</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-20-93" name="__codelineno-20-93"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-20-94" name="__codelineno-20-94"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">offsetProj</span><span class="p">,</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">View</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">worldPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="n">f</span><span class="p">)));</span>
<a id="__codelineno-20-95" name="__codelineno-20-95"></a><span class="p">}</span>
<a id="__codelineno-20-96" name="__codelineno-20-96"></a><span class="kt">float</span><span class="w"> </span><span class="n">calculateFogIntensityFadedVanilla</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">cameraDepth</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">maxDistance</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">fogStart</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">fogEnd</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">fogAlpha</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-97" name="__codelineno-20-97"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cameraDepth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">maxDistance</span><span class="p">;</span>
<a id="__codelineno-20-98" name="__codelineno-20-98"></a><span class="w">    </span><span class="n">distance</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">fogAlpha</span><span class="p">;</span>
<a id="__codelineno-20-99" name="__codelineno-20-99"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">clamp</span><span class="p">((</span><span class="n">distance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fogStart</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">fogEnd</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fogStart</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-20-100" name="__codelineno-20-100"></a><span class="p">}</span>
<a id="__codelineno-20-101" name="__codelineno-20-101"></a><span class="kt">void</span><span class="w"> </span><span class="n">transformAsBillboardVertex</span><span class="p">(</span><span class="k">inout</span><span class="w"> </span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-102" name="__codelineno-20-102"></a><span class="w">    </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<a id="__codelineno-20-103" name="__codelineno-20-103"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">forward</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ViewPositionAndTime</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
<a id="__codelineno-20-104" name="__codelineno-20-104"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">forward</span><span class="p">));</span>
<a id="__codelineno-20-105" name="__codelineno-20-105"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="p">);</span>
<a id="__codelineno-20-106" name="__codelineno-20-106"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">offsets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">vertInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-20-107" name="__codelineno-20-107"></a><span class="w">    </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">offsets</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">offsets</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">);</span>
<a id="__codelineno-20-108" name="__codelineno-20-108"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">ViewProj</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<a id="__codelineno-20-109" name="__codelineno-20-109"></a><span class="p">}</span>
<a id="__codelineno-20-110" name="__codelineno-20-110"></a><span class="kt">float</span><span class="w"> </span><span class="n">RenderChunkVert</span><span class="p">(</span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-111" name="__codelineno-20-111"></a><span class="w">    </span><span class="cp">#ifdef RENDER_AS_BILLBOARDS__ON</span>
<a id="__codelineno-20-112" name="__codelineno-20-112"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-20-113" name="__codelineno-20-113"></a><span class="w">    </span><span class="n">transformAsBillboardVertex</span><span class="p">(</span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-114" name="__codelineno-20-114"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-20-115" name="__codelineno-20-115"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">cameraDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">ViewPositionAndTime</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">);</span>
<a id="__codelineno-20-116" name="__codelineno-20-116"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">fogIntensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateFogIntensityFadedVanilla</span><span class="p">(</span><span class="n">cameraDepth</span><span class="p">,</span><span class="w"> </span><span class="n">FogAndDistanceControl</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">FogAndDistanceControl</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">FogAndDistanceControl</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">RenderChunkFogAlpha</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-20-117" name="__codelineno-20-117"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">fog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">FogColor</span><span class="p">.</span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="n">fogIntensity</span><span class="p">);</span>
<a id="__codelineno-20-118" name="__codelineno-20-118"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jitterVertexPosition</span><span class="p">(</span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">);</span>
<a id="__codelineno-20-119" name="__codelineno-20-119"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cameraDepth</span><span class="p">;</span>
<a id="__codelineno-20-120" name="__codelineno-20-120"></a><span class="p">}</span>
<a id="__codelineno-20-121" name="__codelineno-20-121"></a><span class="kt">void</span><span class="w"> </span><span class="n">RenderChunkVertTransparent</span><span class="p">(</span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-122" name="__codelineno-20-122"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">cameraDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RenderChunkVert</span><span class="p">(</span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-123" name="__codelineno-20-123"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">shouldBecomeOpaqueInTheDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">vertInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.95</span><span class="p">;</span>
<a id="__codelineno-20-124" name="__codelineno-20-124"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shouldBecomeOpaqueInTheDistance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-125" name="__codelineno-20-125"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">cameraDistance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cameraDepth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">FogAndDistanceControl</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-20-126" name="__codelineno-20-126"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">alphaFadeOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clamp</span><span class="p">(</span><span class="n">cameraDistance</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-20-127" name="__codelineno-20-127"></a><span class="w">        </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mix</span><span class="p">(</span><span class="n">stdInput</span><span class="p">.</span><span class="n">vertInput</span><span class="p">.</span><span class="n">color0</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">alphaFadeOut</span><span class="p">);</span>
<a id="__codelineno-20-128" name="__codelineno-20-128"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-129" name="__codelineno-20-129"></a><span class="p">}</span>
<a id="__codelineno-20-130" name="__codelineno-20-130"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_VertSharedTransform</span><span class="p">(</span><span class="k">inout</span><span class="w"> </span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-131" name="__codelineno-20-131"></a><span class="w">    </span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">vertInput</span><span class="p">;</span>
<a id="__codelineno-20-132" name="__codelineno-20-132"></a><span class="w">    </span><span class="cp">#ifdef INSTANCING__ON</span>
<a id="__codelineno-20-133" name="__codelineno-20-133"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-20-134" name="__codelineno-20-134"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-135" name="__codelineno-20-135"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-136" name="__codelineno-20-136"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-137" name="__codelineno-20-137"></a><span class="w">    </span><span class="n">model</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="p">.</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="p">.</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="p">.</span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-20-138" name="__codelineno-20-138"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">wpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">instMul</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-20-139" name="__codelineno-20-139"></a><span class="w">    </span><span class="cp">#else</span>
<a id="__codelineno-20-140" name="__codelineno-20-140"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">wpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">World</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">vertInput</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)).</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-20-141" name="__codelineno-20-141"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-20-142" name="__codelineno-20-142"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul</span><span class="p">(</span><span class="n">ViewProj</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">wpos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<a id="__codelineno-20-143" name="__codelineno-20-143"></a><span class="w">    </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wpos</span><span class="p">;</span>
<a id="__codelineno-20-144" name="__codelineno-20-144"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wpos</span><span class="p">;</span>
<a id="__codelineno-20-145" name="__codelineno-20-145"></a><span class="p">}</span>
<a id="__codelineno-20-146" name="__codelineno-20-146"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_VertexPreprocessIdentity</span><span class="p">(</span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-147" name="__codelineno-20-147"></a><span class="p">}</span>
<a id="__codelineno-20-148" name="__codelineno-20-148"></a>
<a id="__codelineno-20-149" name="__codelineno-20-149"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_InvokeVertexPreprocessFunction</span><span class="p">(</span><span class="k">inout</span><span class="w"> </span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-150" name="__codelineno-20-150"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_InvokeVertexOverrideFunction</span><span class="p">(</span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-151" name="__codelineno-20-151"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_InvokeLightingVertexFunction</span><span class="p">(</span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">);</span>
<a id="__codelineno-20-152" name="__codelineno-20-152"></a>
<a id="__codelineno-20-153" name="__codelineno-20-153"></a><span class="kt">void</span><span class="w"> </span><span class="n">computeLighting_RenderChunk_Vertex</span><span class="p">(</span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vOutput</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-154" name="__codelineno-20-154"></a><span class="w">    </span><span class="n">vOutput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vInput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="p">;</span>
<a id="__codelineno-20-155" name="__codelineno-20-155"></a><span class="p">}</span>
<a id="__codelineno-20-156" name="__codelineno-20-156"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_VertShared</span><span class="p">(</span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-157" name="__codelineno-20-157"></a><span class="w">    </span><span class="n">StandardTemplate_InvokeVertexPreprocessFunction</span><span class="p">(</span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-158" name="__codelineno-20-158"></a><span class="w">    </span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">stdInput</span><span class="p">;</span>
<a id="__codelineno-20-159" name="__codelineno-20-159"></a><span class="w">    </span><span class="n">stdInput</span><span class="p">.</span><span class="n">vertInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertInput</span><span class="p">;</span>
<a id="__codelineno-20-160" name="__codelineno-20-160"></a><span class="w">    </span><span class="n">StandardTemplate_VertSharedTransform</span><span class="p">(</span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-161" name="__codelineno-20-161"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">texcoord0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-20-162" name="__codelineno-20-162"></a><span class="w">    </span><span class="n">vertOutput</span><span class="p">.</span><span class="n">color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertInput</span><span class="p">.</span><span class="n">color0</span><span class="p">;</span>
<a id="__codelineno-20-163" name="__codelineno-20-163"></a><span class="w">    </span><span class="n">StandardTemplate_InvokeVertexOverrideFunction</span><span class="p">(</span><span class="n">stdInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-164" name="__codelineno-20-164"></a><span class="w">    </span><span class="n">StandardTemplate_InvokeLightingVertexFunction</span><span class="p">(</span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">,</span><span class="w"> </span><span class="n">stdInput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">);</span>
<a id="__codelineno-20-165" name="__codelineno-20-165"></a><span class="p">}</span>
<a id="__codelineno-20-166" name="__codelineno-20-166"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_InvokeVertexPreprocessFunction</span><span class="p">(</span><span class="k">inout</span><span class="w"> </span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-167" name="__codelineno-20-167"></a><span class="w">    </span><span class="n">StandardTemplate_VertexPreprocessIdentity</span><span class="p">(</span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-168" name="__codelineno-20-168"></a><span class="p">}</span>
<a id="__codelineno-20-169" name="__codelineno-20-169"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_InvokeVertexOverrideFunction</span><span class="p">(</span><span class="n">StandardVertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-170" name="__codelineno-20-170"></a><span class="w">    </span><span class="cp">#ifdef TRANSPARENT_PASS</span>
<a id="__codelineno-20-171" name="__codelineno-20-171"></a><span class="w">    </span><span class="n">RenderChunkVertTransparent</span><span class="p">(</span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-172" name="__codelineno-20-172"></a><span class="w">    </span><span class="cp">#else</span>
<a id="__codelineno-20-173" name="__codelineno-20-173"></a><span class="w">    </span><span class="n">RenderChunkVert</span><span class="p">(</span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-174" name="__codelineno-20-174"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-20-175" name="__codelineno-20-175"></a><span class="p">}</span>
<a id="__codelineno-20-176" name="__codelineno-20-176"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_InvokeLightingVertexFunction</span><span class="p">(</span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-177" name="__codelineno-20-177"></a><span class="w">    </span><span class="n">computeLighting_RenderChunk_Vertex</span><span class="p">(</span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">,</span><span class="w"> </span><span class="n">worldPosition</span><span class="p">);</span>
<a id="__codelineno-20-178" name="__codelineno-20-178"></a><span class="p">}</span>
<a id="__codelineno-20-179" name="__codelineno-20-179"></a><span class="kt">void</span><span class="w"> </span><span class="n">StandardTemplate_Opaque_Vert</span><span class="p">(</span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="k">inout</span><span class="w"> </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-180" name="__codelineno-20-180"></a><span class="w">    </span><span class="n">StandardTemplate_VertShared</span><span class="p">(</span><span class="n">vertInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertOutput</span><span class="p">);</span>
<a id="__codelineno-20-181" name="__codelineno-20-181"></a><span class="p">}</span>
<a id="__codelineno-20-182" name="__codelineno-20-182"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-183" name="__codelineno-20-183"></a><span class="w">    </span><span class="n">VertexInput</span><span class="w"> </span><span class="n">vertexInput</span><span class="p">;</span>
<a id="__codelineno-20-184" name="__codelineno-20-184"></a><span class="w">    </span><span class="n">VertexOutput</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">;</span>
<a id="__codelineno-20-185" name="__codelineno-20-185"></a><span class="w">    </span><span class="n">vertexInput</span><span class="p">.</span><span class="n">color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a_color0</span><span class="p">);</span>
<a id="__codelineno-20-186" name="__codelineno-20-186"></a><span class="w">    </span><span class="n">vertexInput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a_texcoord1</span><span class="p">);</span>
<a id="__codelineno-20-187" name="__codelineno-20-187"></a><span class="w">    </span><span class="n">vertexInput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a_position</span><span class="p">);</span>
<a id="__codelineno-20-188" name="__codelineno-20-188"></a><span class="w">    </span><span class="n">vertexInput</span><span class="p">.</span><span class="n">texcoord0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a_texcoord0</span><span class="p">);</span>
<a id="__codelineno-20-189" name="__codelineno-20-189"></a><span class="w">    </span><span class="cp">#ifdef INSTANCING__ON</span>
<a id="__codelineno-20-190" name="__codelineno-20-190"></a><span class="w">    </span><span class="n">vertexInput</span><span class="p">.</span><span class="n">instanceData0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_data1</span><span class="p">;</span>
<a id="__codelineno-20-191" name="__codelineno-20-191"></a><span class="w">    </span><span class="n">vertexInput</span><span class="p">.</span><span class="n">instanceData1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_data2</span><span class="p">;</span>
<a id="__codelineno-20-192" name="__codelineno-20-192"></a><span class="w">    </span><span class="n">vertexInput</span><span class="p">.</span><span class="n">instanceData2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_data3</span><span class="p">;</span>
<a id="__codelineno-20-193" name="__codelineno-20-193"></a><span class="w">    </span><span class="cp">#endif</span>
<a id="__codelineno-20-194" name="__codelineno-20-194"></a><span class="w">    </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-195" name="__codelineno-20-195"></a><span class="w">    </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">fog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-196" name="__codelineno-20-196"></a><span class="w">    </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-197" name="__codelineno-20-197"></a><span class="w">    </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">texcoord0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-198" name="__codelineno-20-198"></a><span class="w">    </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-199" name="__codelineno-20-199"></a><span class="w">    </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-20-200" name="__codelineno-20-200"></a><span class="w">    </span><span class="n">ViewRect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewRect</span><span class="p">;</span>
<a id="__codelineno-20-201" name="__codelineno-20-201"></a><span class="w">    </span><span class="n">Proj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_proj</span><span class="p">;</span>
<a id="__codelineno-20-202" name="__codelineno-20-202"></a><span class="w">    </span><span class="n">View</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_view</span><span class="p">;</span>
<a id="__codelineno-20-203" name="__codelineno-20-203"></a><span class="w">    </span><span class="n">ViewTexel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewTexel</span><span class="p">;</span>
<a id="__codelineno-20-204" name="__codelineno-20-204"></a><span class="w">    </span><span class="n">InvView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invView</span><span class="p">;</span>
<a id="__codelineno-20-205" name="__codelineno-20-205"></a><span class="w">    </span><span class="n">InvProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invProj</span><span class="p">;</span>
<a id="__codelineno-20-206" name="__codelineno-20-206"></a><span class="w">    </span><span class="n">ViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewProj</span><span class="p">;</span>
<a id="__codelineno-20-207" name="__codelineno-20-207"></a><span class="w">    </span><span class="n">InvViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invViewProj</span><span class="p">;</span>
<a id="__codelineno-20-208" name="__codelineno-20-208"></a><span class="w">    </span><span class="n">PrevViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_prevViewProj</span><span class="p">;</span>
<a id="__codelineno-20-209" name="__codelineno-20-209"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-20-210" name="__codelineno-20-210"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mo">0</span><span class="p">];</span>
<a id="__codelineno-20-211" name="__codelineno-20-211"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-20-212" name="__codelineno-20-212"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-20-213" name="__codelineno-20-213"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-20-214" name="__codelineno-20-214"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-215" name="__codelineno-20-215"></a><span class="w">    </span><span class="n">World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mo">0</span><span class="p">];</span>
<a id="__codelineno-20-216" name="__codelineno-20-216"></a><span class="w">    </span><span class="n">WorldView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_modelView</span><span class="p">;</span>
<a id="__codelineno-20-217" name="__codelineno-20-217"></a><span class="w">    </span><span class="n">WorldViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_modelViewProj</span><span class="p">;</span>
<a id="__codelineno-20-218" name="__codelineno-20-218"></a><span class="w">    </span><span class="n">PrevWorldPosOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_prevWorldPosOffset</span><span class="p">;</span>
<a id="__codelineno-20-219" name="__codelineno-20-219"></a><span class="w">    </span><span class="n">AlphaRef4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_alphaRef4</span><span class="p">;</span>
<a id="__codelineno-20-220" name="__codelineno-20-220"></a><span class="w">    </span><span class="n">AlphaRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_alphaRef4</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-20-221" name="__codelineno-20-221"></a><span class="w">    </span><span class="n">StandardTemplate_Opaque_Vert</span><span class="p">(</span><span class="n">vertexInput</span><span class="p">,</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">);</span>
<a id="__codelineno-20-222" name="__codelineno-20-222"></a><span class="w">    </span><span class="n">v_color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">color0</span><span class="p">;</span>
<a id="__codelineno-20-223" name="__codelineno-20-223"></a><span class="w">    </span><span class="n">v_fog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">fog</span><span class="p">;</span>
<a id="__codelineno-20-224" name="__codelineno-20-224"></a><span class="w">    </span><span class="n">v_lightmapUV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="p">;</span>
<a id="__codelineno-20-225" name="__codelineno-20-225"></a><span class="w">    </span><span class="n">v_texcoord0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">texcoord0</span><span class="p">;</span>
<a id="__codelineno-20-226" name="__codelineno-20-226"></a><span class="w">    </span><span class="n">v_worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-20-227" name="__codelineno-20-227"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vertexOutput</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-20-228" name="__codelineno-20-228"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<details class="info">
<summary>varying.def.sc</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">varying.def.sc</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">a_color0</span><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">COLOR0</span><span class="p">;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="kt">vec2</span><span class="w"> </span><span class="n">a_texcoord1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD1</span><span class="p">;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">a_position</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">POSITION</span><span class="p">;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="kt">vec2</span><span class="w"> </span><span class="n">a_texcoord0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD0</span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">i_data1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD7</span><span class="p">;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">i_data2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD6</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">i_data3</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD5</span><span class="p">;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="kt">vec4</span><span class="w">          </span><span class="n">v_color0</span><span class="w">     </span><span class="o">:</span><span class="w"> </span><span class="n">COLOR0</span><span class="p">;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="kt">vec4</span><span class="w">          </span><span class="n">v_fog</span><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">COLOR2</span><span class="p">;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="kt">vec2</span><span class="w">          </span><span class="n">v_lightmapUV</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD1</span><span class="p">;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="k">centroid</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">v_texcoord0</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD0</span><span class="p">;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="kt">vec3</span><span class="w">          </span><span class="n">v_worldPos</span><span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="n">TEXCOORD3</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="projectjson">project.json<a class="headerlink" href="#projectjson" title="Permanent link">&para;</a></h2>
<p>Now let's fill the project.json file:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">project.json</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">  </span><span class="nt">&quot;base_profile&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">      </span><span class="s2">&quot;Direct3D_SM40&quot;</span><span class="p">,</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">      </span><span class="s2">&quot;Direct3D_SM50&quot;</span><span class="p">,</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">      </span><span class="s2">&quot;Direct3D_SM60&quot;</span><span class="p">,</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">      </span><span class="s2">&quot;Direct3D_SM65&quot;</span><span class="p">,</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">      </span><span class="s2">&quot;ESSL_300&quot;</span><span class="p">,</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">      </span><span class="s2">&quot;ESSL_310&quot;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">    </span><span class="p">],</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="nt">&quot;merge_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;../vanilla&quot;</span><span class="p">]</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">  </span><span class="nt">&quot;profiles&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">    </span><span class="nt">&quot;windows&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">      </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">        </span><span class="s2">&quot;Direct3D_SM40&quot;</span><span class="p">,</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">        </span><span class="s2">&quot;Direct3D_SM50&quot;</span><span class="p">,</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">        </span><span class="s2">&quot;Direct3D_SM60&quot;</span><span class="p">,</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="w">        </span><span class="s2">&quot;Direct3D_SM65&quot;</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="w">      </span><span class="p">]</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="w">    </span><span class="nt">&quot;android&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a><span class="w">      </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ESSL_300&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ESSL_310&quot;</span><span class="p">]</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This project config targets windows and android platforms by default, but also adds separate profiles for them,
which allows you to choose which platform to compile to using <code>--profile</code> argument.</p>
<div class="admonition warning">
<p class="admonition-title">Compiling Windows shaders</p>
<p>Due to shaderc compiler limitations, you can only compile shaders for Windows (<code>Direct3D</code>) on a Windows machine.
If you are following this tutorial on other OS then you won't be able to compile shaders for Windows.</p>
</div>
<h2 id="adding-shader-effects">Adding shader effects<a class="headerlink" href="#adding-shader-effects" title="Permanent link">&para;</a></h2>
<p>Currently our shader is exactly the same as vanilla and doesn't do anything different, so let's add some interesting effects!</p>
<p>Edit the <code>main()</code> function in <code>fragment.sc</code> and add the highlighted line at the very bottom:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">fragment.sc</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">    </span><span class="n">FragmentInput</span><span class="w"> </span><span class="n">fragmentInput</span><span class="p">;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="n">FragmentOutput</span><span class="w"> </span><span class="n">fragmentOutput</span><span class="p">;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_color0</span><span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">fog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_fog</span><span class="p">;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">lightmapUV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_lightmapUV</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">texcoord0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_texcoord0</span><span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="n">fragmentInput</span><span class="p">.</span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v_worldPos</span><span class="p">;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">    </span><span class="n">fragmentOutput</span><span class="p">.</span><span class="n">Color0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="n">ViewRect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewRect</span><span class="p">;</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">    </span><span class="n">Proj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_proj</span><span class="p">;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">    </span><span class="n">View</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_view</span><span class="p">;</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">    </span><span class="n">ViewTexel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewTexel</span><span class="p">;</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">    </span><span class="n">InvView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invView</span><span class="p">;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">    </span><span class="n">InvProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invProj</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">    </span><span class="n">ViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_viewProj</span><span class="p">;</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">    </span><span class="n">InvViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_invViewProj</span><span class="p">;</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="n">PrevViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_prevViewProj</span><span class="p">;</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mo">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mo">0</span><span class="p">];</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="w">        </span><span class="n">WorldArray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a><span class="w">    </span><span class="n">World</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_model</span><span class="p">[</span><span class="mo">0</span><span class="p">];</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a><span class="w">    </span><span class="n">WorldView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_modelView</span><span class="p">;</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a><span class="w">    </span><span class="n">WorldViewProj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_modelViewProj</span><span class="p">;</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a><span class="w">    </span><span class="n">PrevWorldPosOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_prevWorldPosOffset</span><span class="p">;</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="w">    </span><span class="n">AlphaRef4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_alphaRef4</span><span class="p">;</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a><span class="w">    </span><span class="n">AlphaRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_alphaRef4</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a><span class="w">    </span><span class="n">StandardTemplate_Opaque_Frag</span><span class="p">(</span><span class="n">fragmentInput</span><span class="p">,</span><span class="w"> </span><span class="n">fragmentOutput</span><span class="p">);</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a><span class="hll"><span class="w">    </span><span class="n">fragmentOutput</span><span class="p">.</span><span class="n">Color0</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fragmentOutput</span><span class="p">.</span><span class="n">Color0</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span><span class="w"> </span><span class="c1">// Invert colors.</span>
</span><a id="__codelineno-23-33" name="__codelineno-23-33"></a><span class="w">    </span><span class="nb">gl_FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragmentOutput</span><span class="p">.</span><span class="n">Color0</span><span class="p">;</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>This will invert terrain colors.</p>
<h2 id="compilation">Compilation<a class="headerlink" href="#compilation" title="Permanent link">&para;</a></h2>
<p>Now, we're finally ready to compile the project!</p>
<p>Run the following command (optionally, with <code>-p windows</code>, <code>-p android</code> or <code>-p windows, android</code>, depending on which platforms you wish to compile for):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>lazurite<span class="w"> </span>build<span class="w"> </span>./helloWorld
</code></pre></div>
<p>And it should compile shaders into material, generating a final <code>RenderChunk.material.bin</code> file in the project <code>helloWorld</code> directory.
Now you're ready to try out your shader in-game! If everything was done correctly, you should be able to see the inverted colors effect on blocks.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      This website is not affiliated with Mojang Studios, Microsoft or Nvidia
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>